## jmeter基础使用:
- 首先在测试计划中添加线程组
- 在线程组中添加http请求
- 在请求中写入需要测试的url, 请求方式, 端口号, 路径
  - 若有参数, 可以在路径中添加``?参数名=参数值``
  - 若是表单数据, 可以在参数处中添加``参数名和参数值``
  - 若需要上传文件, 选择文件上传, 点击添加, 在文件名称中写入需要上传的文件路径, 参数名称写入参数名, MIME类型写入对应的类型参数
  - 若是需要传入json数据, 选择``JSON``, 在请求中写入json数据
- 添加监听器, 查看测试结果

## jmeter参数化
- 当使用同一个测试脚本,使用到不同的测试数据,为了不做重复操作,而使用变量来输入数据,叫做参数化   
- 在jemeter当中, 使用``${变量名}``来表示变量, 之后可添加配置元件``用户定义的变量``来为变量输入数据
### 1. 用户定义的变量
- 可以在``用户定义的变量``中添加变量名和变量值, 之后在http请求中使用``${变量名}``来输入变量值
- 若需要使用变量嵌套, 则需要使用[[Jmeter函数#V函数]]
- ``用户定义的变量``定义的变量都是全局变量
  
### 2. <a name="局部变量转全局变量">局部变量转成全局变量</a>
- 有时变量为局部变量, 无法在http请求中使用, 则需要将局部变量转成全局变量
- 可以在http请求中使用``${__setProperty(变量名, ${局部变量名},)}``来将局部变量转成全局变量
- 在其他线程组要使用时, 需要使用[[Jmeter函数#P函数]]来引用全局变量

### 3. CSV文件读取变量
- 添加``CSV文件数据设置``, 在``文件名``中输入csv文件路径, 在``分隔符``中输入分隔符, 在``变量名``中输入变量名, 在``是否包含文件头``中选择是否包含文件头, 在``默认值``中输入默认值, 在``注释``中输入注释
- 同一线程组内的http请求可以使用``${变量名}``来输入变量值
- 若是不同线程组, 则需要使用[局部变量转全局变量](#局部变量转全局变量)

### 4. JDBC request
- 添加``JDBC request``, 在``数据库连接配置``中选择数据库连接, 在``SQL查询``中输入SQL语句, 在``变量名``中输入变量名, 在``默认值``中输入默认值, 在``注释``中输入注释
- 同一线程组内的http请求可以使用``${变量名}``来输入变量值
- 若是不同线程组, 则需要使用[局部变量转全局变量](#局部变量转全局变量)

### 5. 提取器
- 当需要获取http请求返回的数据时,可以使用提取器来提取数据
- 常用的提取器有:
  - **边界提取器**: 输入变量名称, 输入需要获取的字段的左右边界字段, 填入匹配数字
    - 匹配数字: 
      - 为0时, 会随机匹配到任意字段
      - 为1时, 会匹配到第一个字段
      - 为2时, 会匹配到第二个字段
      - 为-1时, 会匹配到所有字段  
  
  - **正则表达式提取器**: 输入正则表达式, 输入需要获取的字段的左右边界字段, 填入匹配数字
    - 匹配数字:
      - 为0时, 会随机匹配到任意字段
      - 为1时, 会匹配到第一个字段
      - 为2时, 会匹配到第二个字段
      - 为-1时, 会匹配到所有字段  
 
  - **XPath提取器**(不常用):
    - 当返回的数据格式为XML时,可以使用XPath提取器来提取数据
      > 在现在web应用中, 大多数页面为HTML, 后端接口返回的是JSON数据, 面对这两种情况更推荐使用JSON提取器和CSS提取器 
    - **操作步骤**:
      - 选择线程组右键, 选择后置处理器, 选择``XPath提取器``
      - 在`XPath提取器`中有以下几个选项:
        - **name(名称)**: 给提取器取一个名称
        - **APPLY TO(应用范围)**:
          - `Main sample only(仅对主采样器应用)`: 仅对主采样器应用
          - `Sub-samples only(仅对子采样器应用)`: 仅对子采样器应用
          - `Main sample and sub-samples(对主采样器和子采样器应用)`: 对主采样器和子采样器应用
          - `JMeter variables(对JMeter变量应用)`: 对JMeter变量应用
        - **XML Parsing options(XML解析选项)**:
          - `Use Tidy(tolerant parser)`: 当处理HTML页面时, 必须把这个选项勾上, tidy会尝试修复不规范的HTML, 将其转换为XHTML. 再进行XPath解析. 不勾选时可能会提取失败
          - `Use Namespaces`: 如果XML包含命名空间, 则必须勾选这个选项
        - **引用名称**: 为提取出来的结果命名一个前缀
        - **XPath表达式**: 用于提取数据的表达式
          - `/`: 根节点
          - `//`: 所有节点
          - `@`: 属性
          - `*`: 任意节点  
        - **Match number(匹配数字)**:
          - 为0时, 会随机匹配到任意字段
          - 为1时, 会匹配到第一个字段
          - 为2时, 会匹配到第二个字段
          - 为-1时, 会匹配到所有字段
        - **Default value(默认值)**: 当提取不到数据时, 会使用默认值
  
  - **JSON提取器**: 
    - 可以从JSON中提取数据
    - **核心语法**:
      - `$`: 表示根节点
      - `.`: 用于访问下一节点
      - `[]`: 用于访问数组中的元素(索引)和对象的名称(名称)
      - `*`: 通配符, 代表所有元素和属性
      - `..`: 用于搜索所有层级的下节点

  - **CSS提取器**:
    - 可以从HTML页面中精准找出数据
    - **核心语法**:
      - `element`: 按照标签名字来选择, 例如`div`,`h1`,`p`
      - `#id`: 按照id选择, 例如`#header`,`#footer`
      - `.classname`: 按照class选择, 例如`.header`,`footer`
      - `[attribute=value]`: 按照属性选择, 例如`[type=text]`
      - `parent child`: 选择父元素下所有的后代元素, 例如`div p`
      - `parent > child`: 只选择父元素下的直接子元素, 例如`div > p`
    - **使用时需要注意的点**:
      - 在CSS提取器中, `Attribute`为空时,会提取元素的文本内容, 如需要提取元素的某个属性值, 则可以填写属性名字, 若要提取id值就填写`id`.
     

## jmeter逻辑控制器
### 循环控制器
#### 1. ForEach循环控制器
- 相当于代码中的``For``循环, 单个变量递增输入来进行循环执行请求
- 需要输入: ``变量前缀, 开始循环字段(不包含), 结束循环字段(包含), 输出变量名称``
  - 变量前缀: 在``用户定义的变量``中需要对变量名添加``_{数字}``, 将下划线前输入到变量前缀中
  - 开始循环字段: 不会包含该字段, 所以一般从0开始
  - 结束循环字段: 会包含该字段, 填入最后一个字段即可
  - 输出变量名称: 将循环的字段再取一次名称,填入http请求内即可

#### 2. 循环控制器
- 只能输入循环次数, 输入多少次就执行多少次, 没有变量添加

#### 3. while循环控制器
- 相当于``do while``, 会先执行一次请求, 再将计数加一
- 一般配合计数器使用
  - 配置元件中可添加计数器
  - 需要输入``开始数值, 递增, 最大数值, 引用名称``
    - 类似于ForEach循环控制器中的输入字段, 只是多了一个递增
- while循环控制器需要输入条件, 一般会用到[[Jmeter函数#jexl3]]
- 再添加http请求到while下方, 在请求内写入变量, 当需要用到变量嵌套时, 需要使用[[Jmeter函数#V函数]]

### 逻辑控制器
#### 1. if逻辑控制器
- 需要输入[[Jmeter函数#jexl3]]函数的表达式, 当表达式为真, 则会执行, 为假时, 不执行

## 线程组
- 在同一线程组内, 线程组的运行顺序是从上到下的.
- 在不同的线程组内, 线程组的运行顺序是随机的.
- **setup线程组**: 会在所有线程组之前执行, 一般用于初始化数据
- **teardown线程组**: 会在所有线程组之后执行, 一般用于清理数据

## 连接数据库
- JMeter本身无法支持连接数据库, 需要使用第三方插件来支持, 可以在测试计划中进行导包
- 导入包后, 添加`JDBC CONNECTION CONFIGURATION`, 
  - 写入数据库连接池变量名
  - 数据库url
  - 数据库驱动
  - 数据库用户名
  - 数据库密码
- 添加`JDBC REQUEST`, 写入连接池变量名和SQL语句